# システム設計

ここではシステム設計の基本的な考え方を学習します。

## システム設計に関する誤解

もう少なくはなっていますがシステム設計に以下のようなイメージを持っている人がいます。

- Excelで処理の内容を箇条書きにした設計書を作る
- 作図ツールを使って図解入りの説明資料を作る
- Excelでテーブル定義書やER図を作る

もしこれらのイメージを持っていたらそのイメージは捨てて下さい。

設計とは限りなくコーディング（実装）に近い物です。

設計者とはプログラミングが出来る技術者の事です。

コードを書けない人がExcel等で作図した物を設計とは呼びません。（あえて名前を付けるなら机上の空論とでも名付けましょう）

「システム設計」でググると上流工程とか下流工程、外部設計、内部設計等の用語解説が上位に表示されます。

これらの用語も一旦忘れてしまって構いません。

これらの解説を行っている記事はウォーターフォール的な考え方で書かれています。

あえて極端な言い方をしますが、ウォーターフォールはアンチパターンです。

ウォーターフォールをベースにした考え方は現実世界ではまず上手く行きません。

良い設計とはアジャイル開発的な考えでしか生まれないと私は考えます。

- （参考）[プログラミングと設計は本来切り離せないもの](http://d.hatena.ne.jp/ryoasai/20101030/1288432422)
- （参考）[ソースコードは設計書であり、コーディングは設計作業である](https://qiita.com/mdstoy/items/5510f94c9ed981cfbb85)

## 設計の基本的な考え方

先程、設計とは資料作りの事ではないと説明しました。

では何が設計の成果物なのかを以下に記載します。

- 試行錯誤の結果完成したクラス設計やディレクトリ構成
- RDBMS等のDBスキーマ
- AWS等のCloudServiceを管理する [Terraform](https://www.terraform.io/) のソースコード

プログラム設計、DB設計、ネットワーク設計等様々な物がありますが、全てに共通して言えるのは成果物が動くモノだと言う事です。

設計とは動くモノを作る行為です。

これだけ聞くと実装との違いが分かりませんが、単なるプログラムなのか設計の成果物なのかは以下の点を意識した作りになっているかで決まります。

- 拡張性が考慮されている事（機能やデータ構造を追加しやすい）
- 保守性が考慮されている事（機能変更がやりやすい）

これらが考慮され、かつ動いている成果物であれば設計の成果物と言えます。

### 設計とは良い実装の延長線である

良いコードを書く為の手法を紹介した [リーダブルコード](https://www.amazon.co.jp/dp/4873115655) という書籍があります。

これは実装の本ですがここに記載されているテクニックの一部は設計でも重要になります。

- 名前に情報を詰め込む（良い名前を付ける事は設計でも最重要）
- 巨大な式を分割する（本では関数の分割方法を紹介しているが、サブシステムやテーブルを分割する時の考え方とも似ている）
- 一度に1つのことを（UNIXという考え方にも出てきた考え方、複雑なシステムもシンプルなサブシステムに分ける事でシンプルに作れる）

良い設計が出来るようになる近道は良いコードを書けるようになる事だったりします。（それだけではありませんが）

- （参考）[リーダブルコード](https://www.amazon.co.jp/dp/4873115655)
- （参考）[UNIXという考え方―その設計思想と哲学](https://www.amazon.co.jp/dp/4274064069)

### 良い設計は初めから手に入らない

ウォーターフォール的な考えでは、要件定義 → 設計 → 実装と流れに従って進めるモノとされています。

この方法は机上の空論なのでまず上手くいく事はないでしょう。

良い設計とは要件定義 → 設計 → 実装を短いスパンで繰り返し何度も作成と破壊を繰り返す事によってしか得られません。

最初から良い設計が出来るという考えを捨てる必要があります。

よって手戻りが発生しても良いように、短いスパンで成果物のレビューを行う事を徹底する事が大事です。

### 詳細仕様書とはテストコードの事

システムの仕様をもっとも正確に表わしているのはソースコードです。

それ以外の仕様書等はソースコードとズレている可能性があるので完全に信用する事は出来ないという事を覚えておきましょう。

良い仕様書を書く方法を考えるくらいなら、良いテストコードを書けるようになりましょう。

現在はユニットテストだけではなく、E2Eテスト（Webサービスの場合はブラウザテスト）等も自動化出来るのでよりその傾向が強まっています。

### ドキュメントはなるべく書かない

ドキュメントをどんなにキレイに書いてもソースコードとズレる可能性をゼロにする事は出来ません。

どんなにキレイに書かれていてもソースコードの動きと異なる情報が一度でも書かれていたら、そのドキュメントに対する信頼は一気になくなります。

そこで発想を変えます。

ドキュメントを自ら書くのではなく、ソースコードからドキュメントを自動生成する方法を考えます。

オープンソースで様々なモノがあるので、代表的なモノをいくつか紹介します。

- [Swagger](https://swagger.io/)
    - YAMLからREST APIのドキュメントを作成するツール
- [JSDoc](https://github.com/jsdoc3/jsdoc)
    - DOCコメントからHTML形式のドキュメントを生成するツール
- [MySQL Workbench](https://www.mysql.com/jp/products/workbench/)
    - MySQLの操作やER図の作成を自動で行う
- [Ansible](https://www.ansible.com/)
    - ミドルウェアの状態を管理するツール
    - ドキュメントだけでなく環境その物を自動生成出来るのでサーバの手順書が不要になる
- [Terraform](https://www.terraform.io/)
    - AWS等のCloudServiceの状態をコードで管理する
    - ドキュメントだけでなく環境その物を自動生成出来るのでインフラ構築の手順が不要になる
- [Cloudcraft](https://cloudcraft.co/)
    - AWSのアカウントからネットワーク構成図を自動生成するツール

ここで紹介出来ない物もたくさんあるので便利なツールは積極的に導入していきましょう。

ただし `README.md` は書いたほうが良いでしょう。

ここにはアプリケーションの起動方法やテストの実行方法、設計の基本方針等をまとめておくとシステムを引き継ぐ人が分かりやすいです。

参考までに私が過去に書いた物を共有させて頂きます。

- [aws-serverless-prototype](https://github.com/keitakn/aws-serverless-prototype)

他にも必要なドキュメントを作成する事は問題ありません。

ただし出来る限りソースコードから自動生成出来ないか考えるようにしましょう。
