# 課題3（ログイン）

他の課題と同様に [ojt-php](https://github.com/keitakn/ojt-php) をベースに開発を進めて行きましょう。

この課題で作成するのはログイン機能になります。

## アウトプット

ログイン処理を行うプログラム。

## 完了条件

以下の仕様を満たすプログラムを完成させましょう。

- メールアドレスとパスワードでログインが出来る事
- バリデーションが実装されている事
- ログインフォームにCSRF対策が実施されている事
- パスワードを間違えた際は適切なエラーメッセージが表示される事
- ログイン状態を維持出来ている事
- ログイン状態の場合、ログインページとユーザー登録系の画面には遷移出来ない仕様になっている事

## ヒント

### 認証について

メールアドレスとパスワードで認証を行った後はログイン状態を維持している必要があります。

これをどのように実現するかを考えてみましょう。

認証（Authentication）とは通信相手が誰かを特定する行為です。

ログイン前はユーザーが誰か分からないので、メールアドレスとパスワードで本人確認を行います。

これが認証です。

ではログイン後はどうかと言うとこれもページ遷移毎に本人確認を行う必要があります。

ログイン成功時にログインセッションを発行して、それをユーザーのブラウザ上に保存します。

ログイン後の認証はログインセッションを元に行います。

要するにやる事は課題2のユーザー登録と同じです。

どのようなデータが必要か考えてみましょう。

### ログイン後のリダイレクト処理について

多くのログイン処理を持つWebシステムはログイン完了後に会員専用ページ等へリダイレクトする処理が入っています。

この課題ではログイン中ユーザー専用ページである `/users/{id}` へリダイレクトさせましょう。

### エラーメッセージについて

ログイン失敗時のエラーメッセージはフォームを赤く表示させる等の工夫を行いましょう。

またパスワードが間違えているか、メールアドレスが登録されていないか、でエラーメッセージを出し分けるようにしましょう。

実戦のシステムではエラーメッセージの出し分けはセキュリティ的な理由であえて詳しく書かない場合もあります。

エラーメッセージからクラッカー（IT技術を悪用する人）にヒントを与える事になります。

よってセキュリティを重視する場合はエラーメッセージをあえて分かりにくくする場合もある事を覚えておいて下さい。

エラーメッセージを出し分けるほうが実装的には難易度が高いので今回は出し分ける方向で実装しましょう。

## このレッスンで身につける事

- Webシステムで認証を行う為の方法
- 安全なログイン処理の作り方

ログイン処理は簡単に見えますがちゃんと作ろうとすると非常に大変です。

実戦ではかなり気を使うのでここを安全に作れるスキルがあれば他のシステムを作成する際にも必ず役に立ちますので頑張りましょう。

また余裕がある場合は [こんな会員制システムにはユーザー登録したくない（ID・パスワードの扱い/入力画面）](https://qiita.com/otagaisama-1/items/18effbe525572eb71ce6) を読んでユーザーが使いやすい仕様を考えて実装してみるのも良いでしょう。

## メンター向け

セキュリティ面で問題ないかを重点的にレビューして下さい。

また課題2と同じようにオブジェクト指向での開発になりますので、オブジェクト設計やテーブル設計等も重点的にレビューして下さい。
