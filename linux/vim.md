# vi(vim)の基礎知識

vi はLinuxに搭載されているテキストエディタです。

サーバ上でファイルを編集する際に利用します。

かなり奥が深く、ここでは説明しきれないので最低限覚えておくべき内容だけ記載しておきます。

よく似たモノに `vim` がありますがこれは `vi` 上位に位置するエディタで非常に高機能です。

Linuxディストリビューションによっては `vi` のエイリアスに `vim` が設定されている事も多いです。（Amazon Linuxは設定されています）

ターミナル上で以下のコマンドを実行してみて下さい。

```bash
which vi
```

下記のように表示されるかと思います。

```text
alias vi='vim'
	/usr/bin/vim
```

なので `vi` と打ってもこのようにエイリアスが設定されている場合は `vim` を利用している事になります。

ちなみに `vim` を使った後に `vi` を使うと不便で仕方なく感じます。

これから覚える人は `vim` の一択でいいでしょう。

ちなみに完全に余談ですが `vim` を極めた人達は全てにおいて `vim` を使いたがります。

このような人たちの事をネット上では [Vimmer](http://d.hatena.ne.jp/keyword/Vimmer) と呼ばれてたりします。

## vi(vim)の使い方

以下のコマンドでファイルを開きます。

```bash
$ vi ファイル名
```

簡単に使い方の説明をします。
viにはノーマルモードと入力モードがあり、はじめはノーマルモードで起動されます。

### ノーマルモードで利用出来る機能

以下はノーマルモードで利用出来る機能です。

#### カーソル移動

カーソルの移動はノーマルモードで行います。

対応するキーは下記の通りです。

| コマンド | 動作 |
|:--------|----:|
| k | 上移動 |
| l | 右移動 |
| h | 左移動 |
| j | 下移動 |


ただし先程も記載した通り、実質使っているのは `vi` ではなく `vim` なので、普通に方向キーで移動が出来ます。

ただしvi互換モードという状態の場合は方向キーでの移動が出来ません。

おそらく多くの人が方向キーで移動するという一般的な操作に慣れているかと思うので、

その場合は ホームディレクトリに `.vimrc` というファイルを作り以下の記述を追加しましょう。

```bash
$ touch ~/.vimrc
$ vi ~/.vimrc
```

↓以下を追記する事で「vi互換モード」を無効化する。

```text
set nocompatible
```

真の [Vimmer](http://d.hatena.ne.jp/keyword/Vimmer) の方々から言わせれば、キー操作に慣れろよと言われるかもしれませんが、

本カリキュラムの目的は 「Webサービスを0から開発出来るようになる」事なので、ここにあまり時間をかけなくても良いと個人的には思います。

もちろん `vim` を極めようと思う事自体は悪い事ではなくむしろ良い事です。

しかし一通りの事が出来るようになってから少しづつ極めるのが良いでしょう。

当たり前ですが `vim` だけを極めてもWebサービスは作れないので。。。

ちなみに私が今まで触ってきた RedHat系のディストリビューションは「vi互換モード」が無効化状態（方向キーで移動が出来る状態）でした。

なので上記の設定等も頭の片隅程度に留めておくだけで十分です。

#### 入力モードへの移行

キーボードの `a` を押すと入力モードに移行します。

他の方法でも移行できますが、ここでは割愛します。

もう一度ノーマルモードに戻るには `esc` キーを押します。

#### 検索

`/***` のように `***` の部分に検索したい文字列を入れます。

例えばこんな感じのテキストがあって "sample" という文字列を検索します。

```text
sample0
sample1
sample2
sample3
```

↓こんな感じで検索結果がハイライトされます。

<img width="847" alt="vi-1" src="https://user-images.githubusercontent.com/11032365/31347385-25b13664-ad57-11e7-8d51-f48cf99e352f.png">

`n` キーを押すと見つかった箇所に上から順番に飛びます。

#### 置換え

開いているファイル内の全てのファイルを置き換える例です。

:%s/置換えたい単語/置換後の単語/g

"example" という単語を "sample" に置き換えるには `:%s/example/sample/g` を実行します。

[vim 文字列置換 基本的な事](https://qiita.com/shirochan/items/a16487d0739f455b5e8a) という良い記事がありましたので共有させて頂きます。

#### コピー&ペースト

コピーしたい行に移動して `yy` と入力します。

`p` でコピーした内容を貼り付けます。

`3yy` のように入力すると今いる行から3行文コピーされます。

全体をコピーしたい時は `:%y` と入力すると全コピー出来ます。

他にも n行目からm行までを指定行をコピーする場合は以下のように入力します。

↓は1行目から4行目までコピーする際の例です。

`:1,4y`

#### 行番号を表示する

`:set number` と入力しましょう。

#### 指定の行にジャンプ

`*G` で指定行にジャンプします。

Gは大文字です、なので20行目にジャンプする場合は `20G` と入力します。

#### 最初の行にジャンプ

`gg` と入力します。こちらは小文字です。

#### 最後の行にジャンプ

`GG` と入力します。こちらは大文字です。

#### 文字コードの変更

文字化けしている場合は `:set encoding=utf-8` 等と文字コードを指定すれば見れる可能性があります。

#### 一つ前の状態に戻る（undo）

`u` を押すと1つ前の状態に戻ります。

Macで言う `command + z` , Windowsで言う `Control + z` ですね。

#### 今いる行を削除する

`dd` と入力すると現在いる行を削除します。

#### 前のコマンドを繰り返す

`.` を押すと前に入力したコマンドを再度実行します。

（例）1つ前に `dd` を実行していたら `.` を入力する事で再度 `dd` を実行する。

#### ファイルを保存する

`:w` を入力すると保存出来ます。

#### 閉じる

`:q` で 閉じます、この時に `:wq` と入力すると編集内容を保存してから閉じます。

逆に編集内容を破棄して閉じたい場合は `:q!` と入力します。

### 入力モードで出来る事

キー操作がいろいろありますが。ここでは割愛させて頂きます。

普通にクリップボードに保存されている内容の貼り付けやコピー等も出来るので、案外それで何とかなったりします。

#### ノーマルモードへの移行

`esc` キーを押下するとノーマルモードへ戻ります。

### その他

#### viewコマンド

`view ファイル名` で参照専用で `vim` を開きます。

しかし巨大なファイルを開くと結構なメモリを消費するのでサーバに悪影響を及ぼす可能性があります。

そもそも参照専用なので `less` や `cat` を使うようにしたほうが良いと個人的には思います。

## vimは奥が深い

ここで紹介したのは、ほんの一部です。（ちょっと調べると分かりますが、マジで奥が深いです。）

他にも色々な事が出来ます、例えば [Vim plugin](https://qiita.com/okamos/items/caf5a0b19ce893a75363) で機能を追加したり自分でPluginを開発したり、[復数のファイルを開いて](https://qiita.com/akata/items/52653ffbc02f46709e3a) 編集したり等です。

しかし最低限ここに載っている内容をある程度、練習したら次のステップに進む事をオススメします。

Web開発を0から行う為にはまだ覚える事がたくさんあるので。。。
